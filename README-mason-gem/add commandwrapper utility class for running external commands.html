<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>add CommandWrapper utility class for running external commands</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1404.34">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Neue'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Neue'; min-height: 16.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; background-color: #d2f1ff}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #a1a111; background-color: #d2f1ff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; background-color: #d2f1ff; min-height: 13.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #b92e18; background-color: #d2f1ff}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #bcbcbc; background-color: #d2f1ff}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #1daf14; background-color: #d2f1ff}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #4a2bda; background-color: #d2f1ff}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #1baeba; background-color: #d2f1ff}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 12.0px Helvetica}
    span.s1 {font-variant-ligatures: no-common-ligatures}
    span.s2 {font-variant-ligatures: no-common-ligatures; color: #1baeba}
    span.s3 {font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s4 {font-variant-ligatures: no-common-ligatures; color: #4a2bda}
    span.s5 {text-decoration: underline ; font-variant-ligatures: no-common-ligatures; color: #1daf14}
    span.s6 {font-variant-ligatures: no-common-ligatures; color: #b92e18}
    span.s7 {font: 11.0px 'Hiragino Sans'; font-variant-ligatures: no-common-ligatures}
    span.s8 {font-variant-ligatures: no-common-ligatures; color: #a1a111}
    span.s9 {font: 11.0px 'Hiragino Sans'; font-variant-ligatures: no-common-ligatures; color: #a1a111}
    span.s10 {text-decoration: underline ; font-variant-ligatures: no-common-ligatures; color: #1baeba}
    span.s11 {text-decoration: underline ; font-variant-ligatures: no-common-ligatures}
    span.s12 {font-variant-ligatures: no-common-ligatures; color: #1daf14}
  </style>
</head>
<body>
<p class="p1"><b>add CommandWrapper utility class for running external commands</b></p>
<p class="p1">2016-01-23</p>
<p class="p2"><br></p>
<p class="p1">The motivation this morning was the annoying proces of installing rbenv and ruby and all the extra steps required to make it work will with Japanese text on OS X. (One might think that if anything was gonna just work with Japanese out of the box, it would be ruby on OS X... but one would be wrong.)</p>
<p class="p2"><br></p>
<p class="p1">Anyway I want to automate that process so that I never have to do it manually again. (especially the searching Google for how to do it part).</p>
<p class="p2"><br></p>
<p class="p1">So, let's bring our old pal CommandWrapper into mason-gem land. I think it is probably OK(?) to just have all the test cases live in <b>test</b> and not try to mimic the folder structure we have in <b>lib</b>.</p>
<p class="p2"><br></p>
<p class="p1">So to start, I will just copy and paste the existing test cases into test/test_command_wrapper:</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$ pygmentize test/test_command_wrapper.rb<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p4"><span class="s2">require</span><span class="s3"> </span><span class="s1">'minitest/autorun'</span></p>
<p class="p4"><span class="s2">require</span><span class="s3"> </span><span class="s1">'mason/command_wrapper'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4">class</span><span class="s3"> </span><span class="s5">CommandWrapperTests</span><span class="s3"> &lt; </span><span class="s1">MiniTest</span><span class="s3">::</span><span class="s1">Unit</span><span class="s3">::</span><span class="s1">TestCase</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1"># mason 2016-01-23: bringing the first bit of my standard ruby code under one roof...</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1"># mason 2011-08-05 fucking around porting ancient python stuff</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">setup</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@class</span><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span>= </span><span class="s1">Mason</span><span class="s3">::</span><span class="s1">CommandWrapper</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3"> = </span><span class="s1">Mason</span><span class="s3">::</span><span class="s1">CommandWrapper</span><span class="s3">.new</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_instantiation_without_command</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1"># A wrapper should have no command by default, and trying to run it should raise.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_nil </span><span class="s6">@instance</span><span class="s1">.command</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_raises(</span><span class="s1">Mason</span><span class="s3">::</span><span class="s1">CommandWrapper</span><span class="s3">::</span><span class="s1">InvalidCommandError</span><span class="s3">) {</span><span class="s1">@instance</span><span class="s3">.run}</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_stdout</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s3"> = </span><span class="s6">@class</span><span class="s3">.new </span><span class="s1">'echo "</span><span class="s7">おはようございます</span><span class="s1">"'</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s1">.stdout.include? </span><span class="s8">"</span><span class="s9">おはよう</span><span class="s8">"</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_equal </span><span class="s4">0</span><span class="s1">, </span><span class="s6">@instance</span><span class="s1">.exit_status <span class="Apple-converted-space">&nbsp; &nbsp;</span></span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_stderr</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s3"> = </span><span class="s6">@class</span><span class="s3">.new </span><span class="s1">'ls /bonkGRONKdonkDONK~~NONEXISTENT'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s1">.raise_on_bad_exit = </span><span class="s4">false</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s3">.stderr.include? </span><span class="s8">"ls:"</span><span class="s3"> </span><span class="s1"># because any message might be localized</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>refute_equal </span><span class="s4">0</span><span class="s1">, </span><span class="s6">@instance</span><span class="s1">.exit_status <span class="Apple-converted-space">&nbsp; &nbsp;</span></span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_simple_ls_use_case</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s1">.command = </span><span class="s8">"ls -la /"</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_equal </span><span class="s4">0</span><span class="s1">, </span><span class="s6">@instance</span><span class="s1">.exit_status</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s1">.stdout.include? </span><span class="s8">"drwx"</span><span class="s1"><span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># surely this will be there on any system we might use?</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s1">.stderr == </span><span class="s8">""</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s1">.exit_status == </span><span class="s4">0</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_working_dir_is_picked_up_at_instantiate_time</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_equal </span><span class="s6">@instance</span><span class="s1">.working_directory, </span><span class="s6">Dir</span><span class="s1">.pwd</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">Dir</span><span class="s1">.chdir(</span><span class="s8">"/Users"</span><span class="s1">)</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3"> = </span><span class="s1">Mason</span><span class="s3">::</span><span class="s1">CommandWrapper</span><span class="s3">.new</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_equal </span><span class="s6">@instance</span><span class="s1">.working_directory, </span><span class="s8">"/Users"</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_exit_status</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s1">.raise_on_bad_exit = </span><span class="s4">false</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_nil </span><span class="s6">@instance</span><span class="s1">.exit_status</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s1">.working_directory = </span><span class="s8">"/Users"</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s1">.command = </span><span class="s8">"ls"</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_equal </span><span class="s4">0</span><span class="s1">, </span><span class="s6">@instance</span><span class="s1">.exit_status</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s3">.command = </span><span class="s1">"ls DOESNTEXISTfjdhsfldjkhlhdfsjk"</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s1">.exit_status != </span><span class="s4">0</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_run_command_return_val</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>exit_status, stdout_output, stderr_output = </span><span class="s6">@instance</span><span class="s1">.run_command </span><span class="s8">'ls -l /'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert exit_status == </span><span class="s4">0</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert stdout_output.length &gt; </span><span class="s4">0</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert stderr_output.length == </span><span class="s4">0</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">def</span><span class="s3"> </span><span class="s1">test_should_raise_on_nonzero_exit_status</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3"> = </span><span class="s1">@class</span><span class="s3">.new </span><span class="s8">'ls -la'</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_equal </span><span class="s4">0</span><span class="s1">, </span><span class="s6">@instance</span><span class="s1">.exit_status</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s3"> = </span><span class="s6">@class</span><span class="s3">.new(</span><span class="s1">'ls -la /dshjkflashdfklahfhsadjkfhlasdhfhasdlhfu'</span><span class="s3">)</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert_raises(</span><span class="s1">Mason</span><span class="s3">::</span><span class="s1">CommandWrapper</span><span class="s3">::</span><span class="s1">UnexpectedExitStatusError</span><span class="s3">) {</span><span class="s1">@instance</span><span class="s3">.run}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s6">@instance</span><span class="s1">.raise_on_bad_exit = </span><span class="s4">false</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1">@instance</span><span class="s3">.run</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>assert </span><span class="s6">@instance</span><span class="s1">.exit_status != </span><span class="s4">0</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p9"><span class="s1">end</span></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p2"><br></p>
<p class="p1">Of course, they will all fail:</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$ rake test</span></p>
<p class="p3"><span class="s1">Run options: --seed 2157</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"># Running tests:</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">EEEEEEEE.</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Finished tests in 0.001030s, 8737.8641 tests/s, 970.8738 assertions/s.</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>1) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_simple_ls_use_case:</span></p>
<p class="p3"><span class="s1">NoMethodError: undefined method `command=' for #&lt;Mason::CommandWrapper:0x007fbf2c8cfcd8&gt;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:42:in `test_simple_ls_use_case'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>2) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_working_dir_is_picked_up_at_instantiate_time:</span></p>
<p class="p3"><span class="s1">NoMethodError: undefined method `working_directory' for #&lt;Mason::CommandWrapper:0x007fbf2c8cf1e8&gt;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:54:in `test_working_dir_is_picked_up_at_instantiate_time'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>3) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_run_command_return_val:</span></p>
<p class="p3"><span class="s1">NoMethodError: undefined method `run_command' for #&lt;Mason::CommandWrapper:0x007fbf2c8ce798&gt;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:77:in `test_run_command_return_val'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>4) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_stdout:</span></p>
<p class="p3"><span class="s1">ArgumentError: wrong number of arguments (1 for 0)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:23:in `initialize'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:23:in `new'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:23:in `test_stdout'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>5) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_should_raise_on_nonzero_exit_status:</span></p>
<p class="p3"><span class="s1">ArgumentError: wrong number of arguments (1 for 0)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:85:in `initialize'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:85:in `new'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:85:in `test_should_raise_on_nonzero_exit_status'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>6) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_instantiation_without_command:</span></p>
<p class="p3"><span class="s1">NoMethodError: undefined method `command' for #&lt;Mason::CommandWrapper:0x007fbf2c8ccbf0&gt;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:17:in `test_instantiation_without_command'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>7) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_exit_status:</span></p>
<p class="p3"><span class="s1">NoMethodError: undefined method `raise_on_bad_exit=' for #&lt;Mason::CommandWrapper:0x007fbf2c8cc2b8&gt;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:63:in `test_exit_status'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>8) Error:</span></p>
<p class="p3"><span class="s1">CommandWrapperTests#test_stderr:</span></p>
<p class="p3"><span class="s1">ArgumentError: wrong number of arguments (1 for 0)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:32:in `initialize'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:32:in `new'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/Users/mason/Code/mason-gem/test/test_command_wrapper.rb:32:in `test_stderr'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1265:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:940:in `block in _run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:933:in `_run_suite'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `block in _run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `map'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:914:in `_run_suites'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:884:in `_run_anything'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1092:in `run_tests'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1079:in `block in _run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `each'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1078:in `_run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:1066:in `run'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/minitest/unit.rb:802:in `block in autorun'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">9 tests, 1 assertions, 0 failures, 8 errors, 0 skips</span></p>
<p class="p3"><span class="s1">rake aborted!</span></p>
<p class="p3"><span class="s1">Command failed with status (1): [ruby -I"lib:test" -I"/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0" "/usr/local/var/rbenv/versions/2.1.5/lib/ruby/2.1.0/rake/rake_test_loader.rb" "test/test*.rb" ]</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Tasks: TOP =&gt; test</span></p>
<p class="p3"><span class="s1">(See full trace by running task with --trace)</span></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">Hmm, LOL, one actually did not fail? That's pretty interesting, since the class being tested currently looks like this:</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$ pygmentize lib/mason/command_wrapper.rb<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p9"><span class="s1">module</span><span class="s3"> </span><span class="s10">Mason</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p10"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">require</span><span class="s3"> </span><span class="s8">'open3'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">class</span><span class="s3"> </span><span class="s11">CommandWrapper</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">def</span><span class="s1"> </span><span class="s12">run</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>nope = </span><span class="s8">"nope nope!"</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s2">puts</span><span class="s1"> nope</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s4">return</span><span class="s1"> nope</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">class</span><span class="s3"> </span><span class="s11">InvalidCommandError</span><span class="s3"> &lt; </span><span class="s6">StandardError</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">class</span><span class="s3"> </span><span class="s11">UnexpectedExitStatusError</span><span class="s3"> &lt; </span><span class="s6">StandardError</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">end</span><span class="s3"> </span><span class="s1"># CommandWrapper class</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p7"><span class="s4">end</span><span class="s3"> </span><span class="s1"># Mason module</span></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p2"><br></p>
<p class="p1">But anyway, no time for that. Implement the class:</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$ pygmentize lib/mason/command_wrapper.rb<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p9"><span class="s1">module</span><span class="s3"> </span><span class="s10">Mason</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p10"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s1">require</span><span class="s3"> </span><span class="s8">'open3'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">class</span><span class="s3"> </span><span class="s11">CommandWrapper</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">attr_accessor</span><span class="s3"> </span><span class="s8">:command</span><span class="s3">, </span><span class="s1"># the whole command string with args, e.g. 'ls -al /foo'</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:working_directory</span><span class="s1">,<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s1">:expected_exit_status</span><span class="s3">,</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:raise_on_bad_exit</span><span class="s1">,</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:exit_status</span><span class="s1">,</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:stdout</span><span class="s1">,</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:stderr</span><span class="s1">,</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:start_time</span><span class="s1">,</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s8">:end_time</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">def</span><span class="s1"> </span><span class="s12">initialize</span><span class="s1">(command = </span><span class="s4">nil</span><span class="s1">)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s6">@command</span><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>= command</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1">@working_directory</span><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span>= </span><span class="s1">Dir</span><span class="s3">.pwd</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1">@expected_exit_status</span><span class="s3"> = </span><span class="s4">0</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1">@raise_on_bad_exit</span><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span>= </span><span class="s4">true</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s6">@exit_status</span><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>= </span><span class="s4">nil</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s6">@stdout_output</span><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>= </span><span class="s4">nil</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s6">@stderr_output</span><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>= </span><span class="s4">nil</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s6">@start_time</span><span class="s1"> <span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>= </span><span class="s4">nil</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s6">@end_time</span><span class="s1"> <span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>= </span><span class="s4">nil</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">def</span><span class="s1"> </span><span class="s12">run</span><span class="s1">()</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1">@exit_status</span><span class="s3">, </span><span class="s1">@stdout</span><span class="s3">, </span><span class="s1">@stderr</span><span class="s3">, </span><span class="s1">@start_time</span><span class="s3">, </span><span class="s1">@end_time</span><span class="s3"> = run_command(</span><span class="s1">@command</span><span class="s3">)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp;</span></span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s4">if</span><span class="s3"> </span><span class="s1">@raise_on_bad_exit</span><span class="s3"> &amp;&amp; (</span><span class="s1">@exit_status</span><span class="s3"> != </span><span class="s1">@expected_exit_status</span><span class="s3">)</span></p>
<p class="p6"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s4">raise</span><span class="s3"> </span><span class="s1">UnexpectedExitStatusError</span><span class="s3">.new(</span><span class="s8">"#{</span><span class="s2">to_s</span><span class="s3"> </span><span class="s8">:short}: expected #{</span><span class="s1">@expected_exit_status</span><span class="s8">} but got #{</span><span class="s1">@exit_status</span><span class="s8">}"</span><span class="s3">)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">def</span><span class="s1"> </span><span class="s12">run_command</span><span class="s1">(cmd_str)</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># run cmd in the shell, wait for exit, and return exit_status, stdout_output, stderr_output, start_time, end_time</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># e.g. exit_status, stdout_output, stderr_output = run_command 'ls -l /'</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s4">if</span><span class="s1"> [</span><span class="s4">nil</span><span class="s1">, </span><span class="s8">''</span><span class="s1">].include? cmd_str</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s4">raise</span><span class="s1"> </span><span class="s6">InvalidCommandError</span><span class="s1">.new(</span><span class="s8">"invalid command: #{</span><span class="s1">cmd_str</span><span class="s8">}"</span><span class="s1">)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>start_time = </span><span class="s6">Time</span><span class="s1">.now</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># Mason 2010-10-17: here is one way to run a one shot command line tool</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># subprocess in Ruby 1.9. The read calls block until the subprocess exits,</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># so when you want get fancy and communicate with the subprocess then</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># this isn't what you need. Also, there's no mechanism yet to have a timeout or</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># interrupt a task that is e.g. stuck waiting for input or otherwise infinite.</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>stdin, stdout, stderr, wait_thr = </span><span class="s6">Open3</span><span class="s1">.popen3(cmd_str)</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># pid = wait_thr[:pid]<span class="Apple-converted-space">&nbsp; </span># pid of the started process.</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># puts "Execute command: " + cmd</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s1"># puts "pid: " + pid.to_s</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>stdout_output = stdout.read</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>stderr_output = stderr.read</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s1"># those block until exit, so after this line subprocess is done</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>status = wait_thr.value<span class="Apple-converted-space">&nbsp; </span></span><span class="s1"># Process::Status object returned.</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>stdin.close<span class="Apple-converted-space">&nbsp; </span></span><span class="s1"># per docs, stdin, stdout and stderr should be closed in this form.</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>stdout.close </span><span class="s1"># dunno if that is really necessary in this use case but it does</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>stderr.close </span><span class="s1"># not seem to hurt...</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>exit_status = status.exitstatus</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>end_time<span class="Apple-converted-space">&nbsp; &nbsp; </span>= </span><span class="s6">Time</span><span class="s1">.now</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s4">return</span><span class="s1"> exit_status, stdout_output, stderr_output, start_time, end_time</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">def</span><span class="s1"> </span><span class="s5">self</span><span class="s1">.</span><span class="s12">run_command</span><span class="s1">(cmd_str)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>cw = </span><span class="s2">self</span><span class="s1">.new cmd_str</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>cw.run</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">def</span><span class="s1"> </span><span class="s12">to_s</span><span class="s1">(style = </span><span class="s8">:short</span><span class="s1">)</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span></span><span class="s8">"#{</span><span class="s2">self</span><span class="s1">.class.name</span><span class="s8">}: #{</span><span class="s6">@command</span><span class="s8">}"</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1"># def run</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1"># <span class="Apple-converted-space">&nbsp; </span>nope = "nope nope!"</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1"># <span class="Apple-converted-space">&nbsp; </span>puts nope</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1"># <span class="Apple-converted-space">&nbsp; </span>return nope</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s1"># end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">class</span><span class="s3"> </span><span class="s11">InvalidCommandError</span><span class="s3"> &lt; </span><span class="s6">StandardError</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">class</span><span class="s3"> </span><span class="s11">UnexpectedExitStatusError</span><span class="s3"> &lt; </span><span class="s6">StandardError</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s4">end</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s4">end</span><span class="s3"> </span><span class="s1"># CommandWrapper class</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span></span></p>
<p class="p7"><span class="s4">end</span><span class="s3"> </span><span class="s1"># Mason module</span></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p2"><br></p>
<p class="p1">And, ba-da-boom:</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$ rake test</span></p>
<p class="p3"><span class="s1">Run options: --seed 30642</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"># Running tests:</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">.........</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Finished tests in 0.030348s, 296.5599 tests/s, 724.9242 assertions/s.</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">9 tests, 22 assertions, 0 failures, 0 errors, 0 skips</span></p>
<p class="p3"><span class="s1">[mason@tokyo mason-gem (master)]$<span class="Apple-converted-space">&nbsp;</span></span></p>
<p class="p2"><br></p>
<p class="p1">OK, so we are still near-zero in terms of actual utility, BUT we have a gem which contains multiple classes and unit tests. This should be all the prep work I need to do before making this gem actually do something useful to me -- install modern Ruby and rbenv and make it work with Japanese on this Mac. (As you can see in some of the printouts above, this Mac still has old Ruby 2.1.... that's because I am waiting for this gem to gain the capability of updating it for me.)</p>
<p class="p2"><br></p>
<p class="p1">Well the current time is Miller Time, so .... until next time!</p>
<p class="p2"><br></p>
<p class="p11"><img src="add%20commandwrapper%20utility%20class%20for%20running%20external%20commands.thumb_IMG_2421_1024.jpg" width="1024" height="768" alt="thumb_IMG_2421_1024.jpg"></p>
</body>
</html>
